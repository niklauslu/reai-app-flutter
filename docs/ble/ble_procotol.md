# 应用协议

## 1. 协议格式

```
CMD:JSON\r\n
```
使用\r\n结尾代表一段数据指令

### 1.1 命令参数
- CMD: 命令名称
- JSON: 命令参数，JSON格式
- 使用`:`分隔命令名称和参数
- CMD和JSON之间使用`:`分隔,CMD必须，JSON不是必须，没有JSON可以不带`:`
- 命令参数可选，根据命令不同，参数格式不同
- 命令参数必须是JSON格式，不能是其他格式，如字符串、数字、布尔值等
- 命令参数必须是UTF-8编码
- 分请求和响应两种情况，格式一样，
- 响应分主动和被动，被动响应的CMD和请求的CMD一致，主动响应的CMD和请求的CMD不一致
- 响应的JSON参数基本格式：
  - code: 可选，默认0，失败时候为其他值，有data可以不用返回
  - message: 可选，成功时可以不返回，失败时必须返回
  - data: 可选，根据命令不同，数据格式不同
  
### 1.2 响应JSON参数基本格式：
```json
{
  "code": 0, // 可选，默认0，失败时候为其他值，有data可以不用返回
  "message": "描述信息", // 可选，成功时可以不返回，失败时必须返回
  "data_key1": "value1", // 可选，根据命令不同，数据格式不同
  "data_key2": "value2" // 可选，根据命令不同，数据格式不同
}
```
#### 列表响应
列表响应分片输出，每次返回一条数据，最后一条数据index为-1
```json
{
  "index": 0, // 列表索引，从0开始
  "key1": "value1", // 可选，根据命令不同，数据格式不同
  "key2": "value2" // 可选，根据命令不同，数据格式不同
}
```

### 1.3 基础示例

- 获取设备信息

  - 请求：
  `BASE_INFO`
  - 响应：
  `BASE_INFO:{"version":"0.1.5","versionCode":105,"hdId":"DYJ001234","name":"DYJ-V2","timestamp": 1223432545}`

- 同步时间

  - 请求：
  `SYNC_TIME:{"timestamp":1672531200}`
  - 响应：
  `SYNC_TIME:{"code": 0, "message": "同步成功"}`